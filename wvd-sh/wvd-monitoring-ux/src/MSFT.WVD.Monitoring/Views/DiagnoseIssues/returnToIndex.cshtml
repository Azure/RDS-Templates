@model DiagonizePageViewModel
@using MSFT.WVD.Monitoring.Common.Models
@{
    ViewData["Title"] = "Diagnose Issues";

}

<div class="width-100 content-section">
    <h2>Search activity feed</h2>
    <br />
    <form asp-controller="DiagnoseIssues" asp-action="IssuesInterval" method="post" id="myform" role="form">
        <div class="ms-Grid" dir="ltr">
            <div class="ms-Grid-row">
                <div class="form-wrap ms-Grid-col ms-xxxl3 ms-xxl3 ms-xl12 m-b-20">
                    <label asp-for="DiagonizeQuery.UPN" class="control-label ms-xxxl2 ms-xxl2 ms-xl2">User UPN<span class="red">*</span></label>
                    <div class="input-wrap ms-xxxl10 ms-xxl12 ms-xl12">
                        <input asp-for="@Model.DiagonizeQuery.UPN" class="form-control" id="upn"  placeholder="Enter User UPN"/>
                        <span asp-validation-for="DiagonizeQuery.UPN" id="validateUpn" class="error-msg validate"></span>
                    </div>
                </div>
                <div class="form-wrap ms-Grid-col ms-xxxl3 ms-xxl3 ms-xl12 m-b-20">
                    <label asp-for="DiagonizeQuery.ActivityType" class="control-label ms-xxxl2 ms-xxl2 ms-xl2"></label>
                    <div class="input-wrap ms-xxxl10 ms-xxl12 ms-xl12">
                        <select size="1" asp-for="DiagonizeQuery.ActivityType" asp-items="Html.GetEnumSelectList<ActivityType>().Where(x=> x.Text != ActivityType.None.ToString() ).ToList()" class="form-control  width-100 " id="activityType"></select>
                    </div>
                </div>
                <div class="form-wrap ms-Grid-col ms-xxxl3 ms-xxl4 ms-xl12 p-l-r-15 m-b-20">
                    <button type="submit" class="ms-Button primary-btn" id="process">
                        <span class="ms-Button-label">Search</span>
                    </button>
                </div>
            </div>
        </div>
    </form>
    <hr />
    <div class="ContextualMenuWrap">
        <div class="ms-ContextualMenuExample export-btn float-left">
            <button class="ms-Button ms-Button--default">
                <span class="ms-Button-label flex-row-center"><i class="ms-Icon ms-Icon--Export" aria-hidden="true"></i>Export</span>
            </button>
           
        </div>
        <div class="ms-ContextualMenuExample filter-btn float-right">
            <button class="ms-Button ms-Button--default">
                <span class="ms-Button-label flex-row-center"><i class="ms-Icon ms-Icon--Filter" aria-hidden="true"></i>Filter</span>
            </button>
            <ul class="ms-ContextualMenu is-hidden ms-ContextualMenu--multiselect">
                <li class="ms-ContextualMenu-item ms-ContextualMenu-item--header">clear all filters</li>

                <li class="ms-ContextualMenu-item ms-ContextualMenu-item--divider"></li>
                <li class="ms-ContextualMenu-item ms-ContextualMenu-item--header">Issues from</li>
                <li class="ms-ContextualMenu-item">
                    @{
                        IDictionary<string, string> routeData = new Dictionary<string, string>();
                        routeData.Add("interval", "Lastonehour");
                        routeData.Add("upn", Model.DiagonizeQuery.UPN);
                    }
                    <a class="ms-ContextualMenu-link" tabindex="1" asp-controller="DiagnoseIssues" asp-action="IssuesInterval" asp-all-route-data="routeData">Last hour</a>
                </li>
                <li class="ms-ContextualMenu-item">
                    @{
                        IDictionary<string, string> routeData1 = new Dictionary<string, string>();
                        routeData1.Add("interval", "Lastonehour");
                        routeData1.Add("upn", Model.DiagonizeQuery.UPN);
                    }
                    <a class="ms-ContextualMenu-link" tabindex="1" asp-controller="DiagnoseIssues" asp-action="IssuesInterval" asp-all-route-data="routeData1">6 hours ago</a>
                </li>
                <li class="ms-ContextualMenu-item">
                    @{
                        IDictionary<string, string> routeData2 = new Dictionary<string, string>();
                        routeData2.Add("interval", "onedayago");
                        routeData2.Add("upn", Model.DiagonizeQuery.UPN);
                    }
                    <a class="ms-ContextualMenu-link" tabindex="1" asp-controller="DiagnoseIssues" asp-action="IssuesInterval" asp-all-route-data="routeData2">1 day ago</a>
                </li>
                <li class="ms-ContextualMenu-item">
                    @{
                        IDictionary<string, string> routeData3 = new Dictionary<string, string>();
                        routeData3.Add("interval", "onweekago");
                        routeData3.Add("upn", Model.DiagonizeQuery.UPN);
                    }
                    <a class="ms-ContextualMenu-link" tabindex="1" asp-controller="DiagnoseIssues" asp-action="IssuesInterval" asp-all-route-data="routeData3">1 week ago</a>
                </li>
                <li class="ms-ContextualMenu-item ms-ContextualMenu-item--divider"></li>
                <li class="ms-ContextualMenu-item ms-ContextualMenu-item--header">Outcome</li>
                <li class="ms-ContextualMenu-item">
                    @{
                        IDictionary<string, string> routeData4 = new Dictionary<string, string>();
                        routeData4.Add("outcome", "Failure");
                        routeData4.Add("upn", Model.DiagonizeQuery.UPN);
                    }
                    <a class="ms-ContextualMenu-link" tabindex="1" asp-controller="DiagnoseIssues" asp-action="IssuesInterval" asp-all-route-data="routeData4">Failed</a>
                </li>
                <li class="ms-ContextualMenu-item">
                    @{
                        IDictionary<string, string> routeData5 = new Dictionary<string, string>();
                        routeData5.Add("outcome", "Success");
                        routeData5.Add("upn", Model.DiagonizeQuery.UPN);
                    }
                    <a class="ms-ContextualMenu-link" tabindex="1" asp-controller="DiagnoseIssues" asp-action="IssuesInterval" asp-all-route-data="routeData5">Success</a>
                </li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
    <table class="ms-Table">
        <thead>
            <tr>
                <th asp-for="Start Time">Start Time</th>
                <th asp-for="End Time">End Time</th>
                <th asp-for="Outcome">Outcome</th>
                <th asp-for="Type">Type</th>
                <th asp-for="Error">Error</th>
                <th asp-for="Session Host">Session Host</th>
                <th asp-for="Client">Client</th>
                <th asp-for="Client Ip">Client Ip</th>
                <th asp-for="HostPoolname">HostPoolname</th>
                <th asp-for="Tenant">Tenant</th>
            </tr>
        </thead>
    </table>
    <div id="Indexnodata">
        <h5 style="text-align:center">No data yet.</h5><p style="text-align:center">Please search User UPN to see data</p>
    </div>
    @if (Model.ConnectionActivity == null || Model.ManagementActivity == null || Model.FeedActivity == null || Model.ConnectionActivity.Count == 0 || Model.ManagementActivity.Count == 0 || Model.FeedActivity.Count == 0)
    {
        <div id="loader1" class="loader"></div>
    }
</div>
<script>
    (function () {
        document.getElementById("Diagnosebreadcrumb").style.display = "block";
        var ContextualMenuElements = document.querySelectorAll(".ms-ContextualMenuExample");
        for (var i = 0; i < ContextualMenuElements.length; i++) {
            var ButtonElement = ContextualMenuElements[i].querySelector(".ms-Button");
            var ContextualMenuElement = ContextualMenuElements[i].querySelector(".ms-ContextualMenu");
            new fabric['ContextualMenu'](ContextualMenuElement, ButtonElement);
        }
        var TableElements = document.querySelectorAll(".ms-Table");
        for (var i = 0; i < TableElements.length; i++) {
            new fabric['Table'](TableElements[i]);
        }
        document.getElementById("upn")
            .addEventListener("change", function () {
                document.getElementById("validateUpn").style.display = "none";
            }, false);
        document.getElementById("upn")
            .addEventListener("keyup", function () {
                document.getElementById("validateUpn").style.display = "none";
            }, false);
        document.getElementById("loader1").hidden = true;
        document.getElementById("process").addEventListener("click", function () {
            document.getElementById("loader1").hidden = false;
        }, false);
    })();
</script>

